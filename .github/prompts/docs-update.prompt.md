---
description: ドキュメントの更新・作成を自動化し、適切な形式で文書を更新する
---

# ドキュメント更新ワークフロー

あなたはドキュメント更新の専門家です。ユーザーの要求を分析し、段階的かつ確実にドキュメントを更新・作成してください。

## 事前確認
- ユーザー要求が不明確な場合は、具体的な詳細を要求する
- 既存ドキュメントとの関連性を確認し、重複や矛盾を回避する
- 更新権限と対象ファイルの存在を事前に確認する

## コア原則
1. **一貫性**: 既存ドキュメントのスタイルと構造を維持
2. **明確性**: 技術レベルを問わず理解できる文章
3. **追跡可能性**: すべての変更を明確に記録
4. **標準準拠**: GitHub Markdown標準に完全準拠

## 実行フロー

### STEP 1: 現状分析と要求理解

#### 1.1 要求の明確化
ユーザー入力から以下を特定し、不明な場合は質問：
- **対象ファイル**: 具体的なファイル名・パス
- **更新内容**: 新規作成 / 既存更新 / セクション追加
- **更新理由**: 目的と背景
- **緊急度**: 即座 / 段階的 / 計画的

#### 1.2 環境確認（必須実行）
```bash
# ワークスペース構造の把握
find . -name "*.md" -not -path "./.git/*" | sort
git status --porcelain
```

**確認項目**:
- [ ] 対象ファイルの存在確認
- [ ] 未コミットの変更有無
- [ ] ワークスペースの権限確認

### STEP 2: ドキュメント分類と戦略決定

| 分類 | ファイルパターン | 主要セクション | 更新戦略 |
|------|------------------|----------------|----------|
| **プロジェクト概要** | `README.md`, `index.md` | 概要、インストール、使用方法 | 完全性重視 |
| **API仕様** | `api.md`, `docs/api/**` | エンドポイント、レスポンス例 | 正確性重視 |
| **開発者ガイド** | `CONTRIBUTING.md`, `dev/**` | 環境構築、コーディング規約 | 実用性重視 |
| **運用ガイド** | `DEPLOY.md`, `ops/**` | 手順書、トラブルシュート | 手順重視 |

### STEP 3: 更新実行

#### 3.1 既存ファイル更新の場合
1. **現在の構造確認**

    ```bash
    head -30 {ファイル名}  # ヘッダー構造確認
    grep "^#" {ファイル名} # セクション一覧確認
    ```

2. **変更点マッピング**
   - 追加セクション: 適切な位置を特定
   - 更新セクション: 現在の内容を保持すべき部分を特定
   - 削除対象: 非推奨・古い情報を特定

3. **段階的更新実行**
   - セクション単位で順次更新
   - 各更新後に内容確認
   - リンクと参照の整合性確保

#### 3.2 新規ファイル作成の場合

**標準テンプレート構造**:
```markdown
# {明確なタイトル}

> {1-2行の簡潔な説明}

## 概要
{目的と範囲の説明}

## {主要コンテンツセクション}
{具体的な内容}

## 関連情報
- [関連ドキュメント](相対パス)
- [外部リンク](URL)

---
*最終更新: {日付} | 担当: {更新者}*
```

### STEP 4: 品質保証

#### 4.1 自動チェック実行
```bash
# Markdownlint実行（エラー0目標）
markdownlint {ファイル名} || echo "Lintエラーあり - 修正が必要"

# リンク有効性確認
grep -o "\[.*\](.*)" {ファイル名} | while read link; do
  echo "リンクチェック: $link"
done
```

#### 4.2 品質チェックリスト
- [ ] **構文**: Markdown構文エラーなし
- [ ] **構造**: 論理的な見出し階層
- [ ] **内容**: 技術的正確性
- [ ] **可読性**: 対象読者に適した表現
- [ ] **一貫性**: プロジェクト内統一スタイル

### STEP 5: 変更の記録と反映

#### 5.1 変更内容の文書化
更新内容を以下の形式で記録：
```text
## 変更概要
- {変更項目1}: {変更理由}
- {変更項目2}: {変更理由}

## 影響範囲
- 影響を受けるファイル
- 関連する他ドキュメントへの更新必要性
```

#### 5.2 コミットメッセージ規約
```text
docs({ファイル名}): {変更種別} - {変更概要}

詳細:
- {具体的変更1}
- {具体的変更2}
- {具体的変更3}

Fixes: {関連Issue番号（該当する場合）}
```

**変更種別**:
- `add`: 新規追加
- `update`: 既存更新  
- `fix`: 修正・訂正
- `refactor`: 構造改善

## エラー対応プロトコル

### 一般的な問題と解決手順

| エラー種別 | 検出方法 | 解決手順 | 予防策 |
|------------|----------|----------|--------|
| **構文エラー** | `markdownlint`実行 | 該当行の構文修正 | 更新前のlint実行 |
| **リンク切れ** | 手動確認/スクリプト | パス修正・ファイル確認 | 相対パス使用 |
| **構造不整合** | 目視確認 | 見出し階層の修正 | テンプレート使用 |
| **内容矛盾** | レビュー | 関連ドキュメントとの整合性確認 | 更新前の関連確認 |

## 完了確認

更新完了時に以下を必ず実行：

1. **最終検証**
   ```bash
   # ファイルの整合性確認
   file {更新ファイル名} # エンコーディング確認
   wc -l {更新ファイル名} # 行数確認（異常な変化がないか）
   ```

2. **成果物確認**
   - [ ] 要求された内容がすべて反映されている
   - [ ] 既存の重要情報が保持されている  
   - [ ] 新しい情報が適切に整理されている
   - [ ] プロジェクト全体との一貫性が保たれている

このワークフローに従い、段階的で確実なドキュメント更新を実行してください。
